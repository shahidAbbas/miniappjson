<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Status Bar Color Demo</title>

    <!-- iOS PWA hints (installed web app) -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />

    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: #fff; /* white background as requested */
        color: #0f172a; /* slate-900 */
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      .page {
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: calc(env(safe-area-inset-top, 0px) + 16px) 16px 24px;
        gap: 20px;
      }
      .pointer {
        display: block;
        width: 28px;
        height: 160px; /* tall enough to clearly point at status bar */
        color: #111; /* arrow color */
      }
      .caption {
        text-align: center;
        font-size: 16px;
        line-height: 1.35;
      }

      .panel {
        width: 100%;
        max-width: 520px;
        border: 1px solid #e5e7eb; /* gray-200 */
        border-radius: 16px;
        padding: 14px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      }
      .row { display: flex; align-items: center; gap: 10px; }
      label { font-size: 14px; color: #334155; min-width: 78px; }
      input[type="text"] {
        flex: 1;
        font-size: 16px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid #cbd5e1; /* gray-300 */
        outline: none;
      }
      input[type="text"]:focus { border-color: #64748b; /* slate-500 */ }
      button {
        appearance: none;
        border: none;
        border-radius: 12px;
        padding: 10px 14px;
        font-size: 15px;
        background: #111;
        color: #fff;
        cursor: pointer;
      }
      .hint { font-size: 12px; color: #64748b; margin-top: 8px; }
      .error { color: #b91c1c; font-size: 13px; display: none; margin-top: 8px; }

      /* Header styles */
      .header {
        position: sticky;
        top: 0;
        background: transparent; /* neutral header */
        color: inherit;
        min-height: 56px; /* standard mobile header height */
        padding-top: env(safe-area-inset-top, 0px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        box-sizing: border-box;
      }

      /* Ensure content sits comfortably below the header */
      .page { padding: 16px 16px 24px; }
    </style>
  </head>
<body>
<section class="wrap" style="
  min-height:100dvh;display:grid;align-content:center;justify-items:center;gap:12px;
  padding:calc(env(safe-area-inset-top,0px)+8px) 16px 16px;font-family:system-ui">
  <!-- arrow -->
  <svg width="26" height="90" viewBox="0 0 24 90" aria-hidden="true" style="display:block;margin:0 auto;color:#111">
    <defs><marker id="arrowhead" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto">
      <polygon points="0 0, 6 3, 0 6"></polygon>
    </marker></defs>
    <line x1="12" y1="82" x2="12" y2="8" stroke="currentColor" stroke-width="3" marker-end="url(#arrowhead)"></line>
  </svg>

  <p style="text-align:center">Below selected color will be reflected in as the statusBar bg color</p>

  <p style="text-align:center">
    selected color:
    <span style="display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#fafafa;">
      <span id="selText">#57ff6a</span>
      <span id="selSwatch" style="width:18px;height:18px;border-radius:5px;border:1px solid #e5e7eb;background:#57ff6a"></span>
    </span>
  </p>

  <div style="display:flex;gap:10px;align-items:center;justify-content:center;width:100%;max-width:420px;">
    <input id="colorHex" type="color" value="#57ff6a" style="width:44px;height:36px;border:none;background:transparent;padding:0">
    <input id="colorText" type="text" value="#57ff6a" placeholder="#RRGGBB"
           style="flex:0 1 220px;padding:9px 10px;border:1px solid #e5e7eb;border-radius:10px;text-align:center">
    <button id="saveBtn" type="button" style="padding:9px 12px;border-radius:10px;background:#111;color:#fff;border:0;">Save</button>
  </div>

  <div style="display:flex;justify-content:center">
    <input id="adminToken" type="password" placeholder="Admin token" autocomplete="off"
           style="width:220px;padding:9px 10px;border:1px solid #e5e7eb;border-radius:10px;text-align:center">
  </div>

  <div id="saveMsg" style="font-size:12px;color:#64748b;min-height:1em;text-align:center"></div>
  <p style="font-size:12px;color:#64748b;text-align:center">
    Saving updates <code>miniApp.json</code> → Vercel redeploys → page reflects on next load.
  </p>
</section>

<script>
  // Read current from miniApp.json so UI matches deployed config
  const hex  = document.getElementById('colorHex');
  const txt  = document.getElementById('colorText');
  const sw   = document.getElementById('selSwatch');
  const stxt = document.getElementById('selText');
  const msg  = document.getElementById('saveMsg');
  const tok  = document.getElementById('adminToken');
  function setLocal(c){ stxt.textContent=c; sw.style.background=c; }
  hex.addEventListener('input', ()=>{ txt.value=hex.value; setLocal(hex.value); });
  txt.addEventListener('input', ()=>{ setLocal(txt.value.trim()); });

  (async () => {
    try {
      const res = await fetch('/miniApp.json?ts=' + Date.now());
      const cfg = await res.json();
      const c = cfg?.statusBar?.theme?.light?.backgroundColor || '#57ff6a';
      hex.value = /^#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i.test(c) ? c : '#57ff6a';
      txt.value = c; setLocal(c);
    } catch {}
  })();

  document.getElementById('saveBtn').addEventListener('click', async () => {
    const color = txt.value.trim();
    msg.textContent = 'Saving…';
    try {
      const r = await fetch('/api/set-statusbar-color', {
        method:'POST',
        headers:{ 'Content-Type':'application/json', 'Authorization':'Bearer ' + tok.value },
        body: JSON.stringify({ color })
      });
      if(!r.ok) throw new Error(await r.text());
      msg.textContent = 'Saved ✅ Vercel will redeploy automatically.';
    } catch(e){ msg.textContent = 'Failed: ' + e.message; }
  });
</script>
</body>
</html>