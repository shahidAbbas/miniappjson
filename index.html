<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Status Bar Color Demo</title>

    <!-- iOS PWA hints (installed web app) -->
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: #fff; /* white background as requested */
        color: #0f172a; /* slate-900 */
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      }
      .page {
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: calc(env(safe-area-inset-top, 0px) + 16px) 16px 24px;
        gap: 20px;
      }
      .pointer {
        display: block;
        width: 28px;
        height: 160px; /* tall enough to clearly point at status bar */
        color: #111; /* arrow color */
      }
      .caption {
        text-align: center;
        font-size: 16px;
        line-height: 1.35;
      }

      .panel {
        width: 100%;
        max-width: 520px;
        border: 1px solid #e5e7eb; /* gray-200 */
        border-radius: 16px;
        padding: 14px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.06);
      }
      .row { display: flex; align-items: center; gap: 10px; }
      label { font-size: 14px; color: #334155; min-width: 78px; }
      input[type="text"] {
        flex: 1;
        font-size: 16px;
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid #cbd5e1; /* gray-300 */
        outline: none;
      }
      input[type="text"]:focus { border-color: #64748b; /* slate-500 */ }
      button {
        appearance: none;
        border: none;
        border-radius: 12px;
        padding: 10px 14px;
        font-size: 15px;
        background: #111;
        color: #fff;
        cursor: pointer;
      }
      .hint { font-size: 12px; color: #64748b; margin-top: 8px; }
      .error { color: #b91c1c; font-size: 13px; display: none; margin-top: 8px; }

      /* Header styles */
      .header {
        position: sticky;
        top: 0;
        background: transparent; /* neutral header */
        color: inherit;
        min-height: 56px; /* standard mobile header height */
        padding-top: env(safe-area-inset-top, 0px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
        box-sizing: border-box;
      }

      /* Ensure content sits comfortably below the header */
      .page { padding: 16px 16px 24px; }
    </style>
  </head>
<body>
  <main class="wrap">
    <!-- Arrow -->
    <svg class="pointer" viewBox="0 0 24 110" aria-hidden="true">
      <defs><marker id="arrowhead" markerWidth="6" markerHeight="6" refX="3" refY="3" orient="auto">
        <polygon points="0 0, 6 3, 0 6"></polygon>
      </marker></defs>
      <line x1="12" y1="100" x2="12" y2="8" stroke="currentColor" stroke-width="3" marker-end="url(#arrowhead)"></line>
    </svg>

    <!-- Required copy (as you wrote it) -->
    <p class="caption">Below selected color will be reflected in as the statusBar bg color</p>

    <!-- Selected color line -->
    <p class="selected-line">
      selected color:
      <span class="chip">
        <span id="selText">#90EE90</span>
        <span id="selSwatch" class="swatch" style="background:#90EE90;"></span>
      </span>
    </p>

    <!-- Compact controls: color, token, save -->
    <div class="controls" role="group" aria-label="Color controls">
      <input id="colorHex" type="color" value="#90EE90" aria-label="Color picker">
      <input id="colorText" type="text" value="#90EE90" placeholder="#RRGGBB" aria-label="Color hex">
      <button id="saveBtn" type="button">Save</button>
    </div>

    <!-- Optional admin token (kept small to avoid scroll). Remove if you secure elsewhere. -->
    <div class="controls" style="grid-template-columns: 1fr;" aria-label="Admin token">
      <input id="adminToken" type="password" placeholder="Admin token" autocomplete="off">
    </div>

    <div class="msg" id="saveMsg"></div>
    <p class="hint">Saving updates <code>miniApp.json</code> in Git &rarr; Vercel redeploys &rarr; this page will reflect on next load.</p>
  </main>

  <script>
    // Minimal UI logic (does NOT touch <meta name="theme-color">)
    const hex  = document.getElementById('colorHex');
    const txt  = document.getElementById('colorText');
    const sw   = document.getElementById('selSwatch');
    const stxt = document.getElementById('selText');
    const btn  = document.getElementById('saveBtn');
    const tok  = document.getElementById('adminToken');
    const msg  = document.getElementById('saveMsg');

    function setLocal(c) {
      stxt.textContent = c;
      sw.style.background = c;
    }
    hex.addEventListener('input', () => { txt.value = hex.value; setLocal(hex.value); });
    txt.addEventListener('input', () => { setLocal(txt.value.trim()); });

    // Load current from miniApp.json so UI matches deployed config
    (async () => {
      try {
        const res = await fetch('/miniApp.json?ts=' + Date.now());
        const cfg = await res.json();
        const c = cfg.statusBarBgColor || '#90EE90';
        hex.value = /^#([0-9a-f]{3}|[0-9a-f]{6}|[0-9a-f]{8})$/i.test(c) ? c : '#90EE90';
        txt.value = c;
        setLocal(c);
      } catch {}
    })();

    btn.addEventListener('click', async () => {
      const color = txt.value.trim();
      msg.textContent = 'Saving…';
      try {
        const r = await fetch('/api/set-color', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + tok.value
          },
          body: JSON.stringify({ color })
        });
        if (!r.ok) throw new Error(await r.text());
        msg.textContent = 'Saved ✅ Vercel will redeploy automatically.';
      } catch (e) {
        msg.textContent = 'Failed: ' + e.message;
      }
    });
  </script>
</body>
</html>
